# What and Why Nix?

Nix is a powerful package manager for Linux and other Unix systems that makes package management reliable and reproducible. It aims to provide a robust and simple way to handle packages and their dependencies, ensuring that the same package setup can be replicated across multiple environments without any inconsistencies.

The key features of Nix are:

1. **Reproducibility:** Nix ensures that installing or upgrading one package cannot break other packages. It allows multiple versions of a package to coexist on the same system.

2. **Isolation:** Nix isolates packages from each other. This means that unlike traditional package managers, it doesn't have global state that can be mutated by packages.

These features make Nix an excellent tool for creating reproducible development environments, reducing the "it works on my machine" problem.

- [Nix Tutorial](https://nix.dev/tutorials/)
- [A step towards the future of configuration and infrastructure management with Nix](https://blog.container-solutions.com/step-towards-future-configuration-infrastructure-management-nix)
- [Is there much difference between using nix-shell and docker for local development? - Help - NixOS Discourse](https://discourse.nixos.org/t/is-there-much-difference-between-using-nix-shell-and-docker-for-local-development/807)
- [What is /usr/bin/env?](https://stackoverflow.com/questions/43793040/how-does-usr-bin-env-work-in-a-linux-shebang-line)
- [Nix + Make](https://www.reddit.com/r/NixOS/comments/8hefx5/nixshell_as_interpreter_for_a_makefile/)

## Dependencies

Nix(package manager):
- [nix](https://nixos.org/download/) &rarr; installs `nix-shell`
- [nixfmt](https://github.com/NixOS/nixfmt) (optional)

# How to build images?

Project's sructure:

```
.
├── bin
│   └── image.bin   <- Binary image used by 'qemu'
├── core            <- Assembly files used to init the processor
├── kernel          <- C files
├── linker          <- Linker files
│   ├── mmap.ld
│   └── zynq.ld
├── obj             <- Object files generated by the Assembler
├── proc            <- Assembly functions used as "helpers" to init hw and peripherals
└── sys             <- Assembly files used to handle the syscalls
```

To build the project and assemble/compile files located at `core/*.s`/`sys/*.s`/`proc/*.s`  and `kernel/*.c`run:

Using `nix-shell`:

```sh
make nix.build
```

Locally:

```sh
make build
```

> [!IMPORTANT]
> The Makefile contains targets for both the Nix package manager and Ubuntu/Debian packages. The targets starting with `nix.` should be fully functional on any machine that supports the nix-shell environment.

Within the `test_logs` folder, you'll find gdb session logs showing the output of the **tagged** git state. For example, if the tag is `tag0`, the `test_logs/gdb_session0.log` file shows the gdb session for that tag's state.

To build and run a tagged release:
1. Check out the desired tag using the command `git checkout tags/<tag_name>`.
2. Execute `make build` to build the project.
3. Run `make qemuA8` to execute the project on QEMU.
4. Open a new terminal and run `make debug` to debug the project.


# References

- [ARMV7 - ASM Quick Reference](https://courses.cs.washington.edu/courses/cse469/20wi/armv7.pdf)
- [ARM - Programmer's Guide](https://developer.arm.com/documentation/den0013/d)

## Exception Handling
- [ARM bootloader: Interrupt Vector Table Understanding - Stack Overflow](https://stackoverflow.com/questions/21312963/arm-bootloader-interrupt-vector-table-understanding)
- [ARM Cortex-A Series Programmer's Guide for ARMv7-A](https://developer.arm.com/documentation/den0013/d/Exception-Handling/Exception-handling)
- [ARM bootloader: Interrupt Vector Table Understanding - Stack Overflow](https://stackoverflow.com/questions/21312963/arm-bootloader-interrupt-vector-table-understanding)
- [ARM Cortex-A Series Programmer's Guide for ARMv7-A](https://developer.arm.com/documentation/den0013/d/Exception-Handling/Exception-handling)
- [ARM Cortex-A Series Programmer's Guide for ARMv7-A](https://developer.arm.com/documentation/den0013/d/Boot-Code/Booting-a-bare-metal-system?lang=en)
- [ARM Cortex-A Series Programmer's Guide for ARMv7-A](https://developer.arm.com/documentation/den0013/d/Boot-Code/Booting-a-bare-metal-system?lang=en)
